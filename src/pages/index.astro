---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import LatestContentCard from "../components/LatestContentCard.astro";
import { Code, BookOpen, Utensils } from "lucide-astro";

// Get blog posts
const blogPosts = await getCollection("blog", ({ data }: { data: CollectionEntry<"blog">["data"] }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});

// Sort and get latest blog post
const latestBlogPost = blogPosts
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.at(0);

// Get recipes (assuming you have a "recipes" collection)
const recipes = await getCollection("recipes", ({ data }: { data: CollectionEntry<"recipes">["data"] }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});

// Sort and get latest recipe
const latestRecipe = recipes
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.at(0);

const projects = await getCollection("projects", ({ data }: { data: CollectionEntry<"projects">["data"] }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});

const latestProject = projects
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .at(0);

---

<BaseLayout 
	title="Luke Melnik"
	description="Developer and musician."
	image="/social-image.jpg"
>
	<main class="max-w-4xl mx-auto px-4 pt-6">
		<section class="mb-10">
			<p class="text-xl leading-relaxed text-foreground/80">
				Welcome! This is my digital garden where I share my projects, writing, and favourite recipes (<span class="italic">those are mostly for my mom but you're welcome to get on board</span>). The site is built with Astro (with React) and is <a href="" class="fancy-link" target="_blank" referrerpolicy="no-referrer">open source</a>. 
			</p>
		</section>
		
		<div class="flex flex-col gap-4">
			<!-- Latest Project -->
			<section class="space-y-4">
				<div class="flex items-center justify-between border-b text-foreground/80">
					<h2 class="text-2xl  pb-2 flex items-center gap-2  font-light">
						 Latest Project
					</h2>
					<Code size={24} />
				</div>
				{latestProject ? (
					<LatestContentCard item={latestProject} type="projects" showDate={false} />
				) : (
					<p class="text-gray-500 italic">Projects coming soon...</p>
				)}
			</section>

			<!-- Latest Blog Post -->
			<section class="space-y-4">
				<div class="flex items-center justify-between border-b text-foreground/80">
					<h2 class="text-2xl font-semibold pb-2 flex items-center gap-2">
						Latest Post
					</h2>
					<BookOpen size={24} />
				</div>
				{latestBlogPost && (
					<LatestContentCard item={latestBlogPost} type="blog" />
				)}
			</section>

			<!-- Latest Recipe -->
			<section class="space-y-4">
				<div class="flex items-center justify-between border-b text-foreground/80">
					<h2 class="text-2xl font-semibold pb-2 flex items-center gap-2">
						Latest Recipe
					</h2>
					<Utensils size={24} />
				</div>
				{latestRecipe ? (
					<LatestContentCard item={latestRecipe} type="recipes" />
				) : (
					<p class="text-gray-500 italic">Recipes coming soon...</p>
				)}
			</section>
		</div>
	</main>
</BaseLayout>
