---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import LatestContentCard from "../components/LatestContentCard.astro";

// Get blog posts
const blogPosts = await getCollection("blog", ({ data }: { data: CollectionEntry<"blog">["data"] }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});

// Sort and get latest blog post
const latestBlogPost = blogPosts
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.at(0);

// Get recipes (assuming you have a "recipes" collection)
const recipes = await getCollection("recipes", ({ data }: { data: CollectionEntry<"recipes">["data"] }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});

// Sort and get latest recipe
const latestRecipe = recipes
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.at(0);

const projects = await getCollection("projects", ({ data }: { data: CollectionEntry<"projects">["data"] }) => {
	return import.meta.env.PROD ? data.draft !== true : true;
});

const latestProject = projects
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .at(0);

---

<BaseLayout 
	title="Luke Melnik"
	description="Developer and musician."
	image="/social-image.jpg"
>
	<main class="max-w-4xl mx-auto px-4 py-12">
		<section class="mb-16">
			<p class="text-xl leading-relaxed">
				Welcome! This is my digital garden where I share my projects, thoughts, and favourite recipes (those are mostly for my mom but you're welcome to get on board).
			</p>
		</section>
		
		<div class="flex flex-col gap-10">
			<!-- Latest Project -->
			<section class="space-y-4">
				<h2 class="text-2xl font-semibold border-b border-gray-200 pb-2">Latest Project</h2>
				{latestProject ? (
					<LatestContentCard item={latestProject} type="projects" showDate={false} />
				) : (
					<p class="text-gray-500 italic">Projects coming soon...</p>
				)}
			</section>

			<!-- Latest Blog Post -->
			<section class="space-y-4">
				<h2 class="text-2xl font-semibold border-b border-gray-200 pb-2">Latest Post</h2>
				{latestBlogPost && (
					<LatestContentCard item={latestBlogPost} type="blog" />
				)}
			</section>

			<!-- Latest Recipe -->
			<section class="space-y-4">
				<h2 class="text-2xl font-semibold border-b border-gray-200 pb-2">Latest Recipe</h2>
				{latestRecipe ? (
					<LatestContentCard item={latestRecipe} type="recipes" />
				) : (
					<p class="text-gray-500 italic">Recipes coming soon...</p>
				)}
			</section>
		</div>
	</main>
</BaseLayout>
